/*
 RequireJS text 0.27.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

(function(){define("bs/util/pubsub",[],function(){var e=function(){this.channelHandlers={}};return e.prototype={channels:{scores_update:"story_scores:update",scores_update_error:"story_scores:error",user_auth:"user_auth:success",scrolltop:"scrolltop",popular_stories_rendered:"popular_stories_rendered",new_stories_rendered:"new_stories_rendered"},on:function(e,t,n,r){var i=this.channelHandlers[t];return i||(i=this.channelHandlers[t]=[]),n&&typeof n=="function"&&(n._scope=r||null,i.push(n)),this},one:function(e,t,n){var r=this,i=function(){var s=_.toArray(arguments);n.apply(this,s),r.off(e,t,i)};return this.on(e,t,i),this},off:function(e,t,n){var r=this.channelHandlers[t];return r&&(this.channelHandlers[t]=_.reject(r,function(e){return e===n})),this},fire:function(e){var t=this.channelHandlers[e],n=_.toArray(arguments).slice(1);return t&&_.each(t,function(e){e.apply(e._scope,n)},this),this}},new e}),define("bs/util/cookies",[],function(){var e={set:function(e){var t=[];typeof e=="object"&&(typeof e.name=="string"&&e.name.length>0&&(typeof e.value=="string"||typeof e.value=="number"||typeof e.value=="boolean")&&t.push($.trim(e.name)+"="+escape(e.value)),e.expires instanceof Date&&t.push("expires="+e.expires.toGMTString()),typeof e.path=="string"&&t.push("path="+e.path),typeof e.domain=="string"&&t.push("domain="+e.domain),typeof e.secure=="boolean"&&e.secure&&t.push("secure"),document.cookie=t.join(";"))},get:function(t){var n=e.getAll();return typeof n[t]!="undefined"?n[t]:null},getAll:function(){var e={},t=document.cookie;if(t){var n=null,r=null,i=null,s=t.split(";"),o=s.length-1;if(o>=0)do i=s[o].split("="),n=$.trim(i[0]),r=i[1],n!=="expires"&&typeof r!="undefined"&&(e[n]=decodeURIComponent(r));while(o--)}return e},remove:function(t){var n={};typeof t=="string"?n.name=t:typeof t=="object"&&$.extend(n,t),n.value="",n.expires=new Date(0),e.set(n)}};return e}),define("bs/util/validation",[],function(){return{isURL:function(e){return/\b((?:https?:\/\/(?:www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4})\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/i.test(e)},isEmail:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\ ".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA -Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}}}),define("jquery",[],function(){return jQuery}),define("lodash",[],function(){return _}),define("bs/util/xhr",["bs/util/cookies","jquery","lodash"],function(e,t,n){var r={dataType:"digg",converters:{"text digg":function(e){var n=t.parseJSON(e);if(n.status!=="ok")throw new Error("Bad Digg API Response: "+n.mesg);return n}},traditional:!0};return{config:n.clone(r),dataProvider:function(){var i=function(e){this.config=n.extend(n.clone(r),e)};return i.prototype={isPolling:function(){return!!this.pollingRef},request:function(r){var i=n.extend(n.clone(this.config),r);return i.type==="POST"&&(i.data=i.data||{},i.data._xsrf=e.get("_xsrf")),t.ajax(i)},startPolling:function(e,n){var r=n.delayStart||!1;t.proxy(function(){r?r=!1:this.request(n),this.pollingRef=setTimeout(t.proxy(arguments.callee,this),e)},this)()},stopPolling:function(){this.pollingRef&&(clearTimeout(this.pollingRef),this.pollingRef=null)}},i}()}}),define("bs/util/helpers",[],function(){var e=["You've got a lot of work to do, slacker.","C'mon!",'Just "Mark as Read". You know you want to.'];return{transitionEndEventNames:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",msTransition:"MSTransitionEnd",transition:"transitionend"},popWin:function(e,t,n){return n.width&&n.height&&(n.left=window.screen.width/2-n.width/2,n.top=window.screen.height/2-n.height/2),n=$.param(n).replace(/&/g,","),window.open(e,t,n)},createGlobalCallback:function(e){var t="cb"+(new Date).valueOf();return window[t]=function(){e.apply(this,arguments);try{delete window[t]}catch(n){window[t]=null}},t},listen:function(e,t,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var r=t.attachEvent("on"+e,n);return r}},unlisten:function(e,t,n){if(t.addEventListener)t.removeEventListener(e,n,!1);else if(t.detachEvent){var r=t.detachEvent("on"+e,n);return r}},throttle:function(t,n){var r=null;return function(){var e=this,i=arguments;clearTimeout(r),r=setTimeout(function(){t.apply(e,i)},n)}},deparam:function(e){var t,n={};return e[0]==="?"&&(e=e.substring(1)),t=e.split("&"),$.each(t,function(e,t){var r=t.split("=");n[r[0]]=decodeURIComponent(r[1])}),n},param:function(e){return $.param(e,!0)},makeExpandingArea:function(e){var t=e.querySelector("textarea"),n=e.querySelector("span");t.addEventListener?(t.addEventListener("input",function(){n.textContent=t.value},!1),n.textContent=t.value):t.attachEvent&&(t.attachEvent("onpropertychange",function(){n.innerText=t.value}),n.innerText=t.value),e.className+=" active"},enforceRangeLimits:function(e,t,n){return e<t?t:e>n?n:e},getMaxUnreadMessage:function(){var t=Math.floor(Math.random()*e.length);return e[t]},isElementInViewport:function(e){var t=e[0].getBoundingClientRect(),n=e.parents(".scrollable"),r;r=n[0]&&n[0].getBoundingClientRect();if(!r)return;return t.bottom>=r.bottom?"bottom":t.top<=r.top?"top":!0},chunkString:function(e,t){var n=[],r=0,i=t;if(e.length%t!==0)throw new Error("chunkString(): cannot chunk str argument based on chunkLen");while(i<e.length)n.push(e.substr(r,t)),r+=t,i+=t;return n}}}),define("bs/util/i18n",[],function(){var e={Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",May:"May",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec"};return{__:function(t,n){return e[t]?e[t]:t}}}),define("bs/util/format",["bs/util/i18n"],function(e){function t(e,t){return t||(t=1),e?e:t}function n(t){var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e.__(n[t])}function r(e){var t=e.getHours(),n=e.getMinutes(),r=t>=12?"pm":"am";t%=12,t=t?t:12,n=n<10?"0"+n:n;var i=t+":"+n+" "+r;return i}return{secondsToFuzzyTime:function(e,r){var i=6e4,s=60*i,o=24*s,u=7*o,a=o*3652425/12e4,f=o*3652425/1e4,l=new Date(e*1e3),c=new Date,h=c-l,p,d=r?"":" ago";return h<i?p="just now":h/i<=45?p=t(Math.floor(h/i),1)+"m"+d:h/s<=16?p=t(Math.floor(h/s),1)+"h"+d:h/o<=6?p=t(Math.floor(h/o),1)+"d"+d:h/u<=6?p=t(Math.floor(h/u),1)+"w"+d:h/f<=1?p=[l.getDate(),n(l.getMonth())].join(" "):p=[l.getDate(),n(l.getMonth()),l.getFullYear()].join(" "),p},secondsToDiggReaderTime:function(e){var t,i=new Date(e*1e3),s=i.getDate(),o=i.getMonth(),u=i.getFullYear(),a=new Date,f=a.getDate(),l=(new Date(new Date(a.getFullYear(),a.getMonth(),a.getDate()-1))).getDate(),c=a.getMonth(),h=a.getFullYear();return s===f&&o===c&&u===h?t=r(i):s===l&&o===c&&u===h?t="Yesterday":u===h?t=n(o)+" "+s:t=n(o)+" "+s+" "+u,t},intWithCommas:function(e,t){var n=(e+"").split("").reverse(),r=[],i,s,o=0,u;for(i=1,s=n.length;i<=s;i++)i%3===0?(r.push(n[i-1]),i!==s&&(r.push(","),o++)):r.push(n[i-1]);return t&&s>4?(u=r.reverse().join("").split(",")[0],o===1?u+="k":o===2&&(u+="m")):u=r.reverse().join(""),u},slugify:function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}}}),define("bs/widgets/dailydiggsub",["bs/core","bs/util/xhr","jquery"],function(e,t,n){function u(e){var o=n(e.target).find(".form-dailydigg-input"),u=n.trim(o.val()),l=require("bs/core").user.isLoggedIn()?"/api/settings/email.json":"/api/dailydiggemail.json",c=new t.dataProvider({url:l,type:"POST",data:{email:u},success:a,error:f},e),h;return i=e,r=n(e.target),s||(h=document.createElement("div"),h.className="response",r.append(h),s=!0),c.request(),e.stopPropagation(),e.preventDefault(),!1}function a(e){r.removeClass("error").addClass("success").find(".response").html("Thanks for subscribing!"),require("bs/core").pubsub.fire("dailydigg_subscribe_success",i)}function f(e){r.addClass("error").find(".response").html("There was a problem submitting your email. Please try again.")}var r,i,s=!1,o=!1;return{init:function(){if(o)return;o=!0,n(document).on("submit",".form-dailydigg-sub",u)}}}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"0.27.0",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&i.inlineText&&(u[e]=n),r(n)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("text!bs/templates/popover.html",[],function(){return'<div class="popover" role="dialog" aria-hidden="true">\n    <div class="arrow"></div>\n    <div class="btn-close">&#x2716;</div>\n    <div class="popover-content"><%= popoverContent %></div>\n</div>'}),define("text!bs/templates/onboard_firstdigg.html",[],function(){return'<div id="first-digg" class="first-digg">\n<% if (facebook && fb_enable_og) { %>\n    <div class="facebook">\n        <h5 class="hed">Success!</h5>\n        <p>Your diggs will appear in your Facebook timeline.<br/>\n           <a href="/settings">Go to Settings</a> to change this preference.</p>\n    </div>\n<% } else { %>\n    <div class="twitter">\n        <h5 class="hed">You dugg this story!</h5>\n        <p>Thanks for that.</p>\n    </div>\n<% } %>\n</div>'}),define("text!bs/templates/onboard_firstsave.html",[],function(){return'<h5 class="hed">Saved!</h5>\n<p>Saved stories are also synced to your<br/>iPhone, iPad, and/or Android device.</p>\n'}),define("text!bs/templates/modal_dailydigg.html",[],function(){return'<div id="modal-dailydiggsub" class="modal-dailydiggsub modal fade hide" role="dialog" aria-hidden="true">\n    <header class="modal-header">\n        <span class="modal-header-text">Subscribe to <b>The Daily Digg</b></span>\n        <div id="btn-savedstories-modal-close" class="btn-modal-close">✖</div>\n    </header>\n    <section class="modal-body">\n    \n        <p class="pitch">Welcome to Digg! Every day we send an email with a handful of our <b>top stories</b> and <b>videos</b> and none of the clutter, noise, or cats that usually distract you.</p>\n    <% if (campaignVersion < 4) { %>\n        <div class="kudos">\n        <% if (campaignVersion == 0) { %>\n            <blockquote class="tweet" cite="https://twitter.com/stevekovach/status/408209270900260864"><p>The @digg newsletter is the best email newsletter I get. It\'s also the only one.</p><footer><b>Steve Kovach</b>&nbsp;<a href="https://twitter.com/stevekovach/status/408209270900260864" target="_blank">@stevekovach&nbsp;&nbsp;Dec 4, 2013, 7:20am</a></footer></blockquote>\n        \n        <% } else if (campaignVersion == 1) { %>\n            <blockquote class="tweet" cite="https://twitter.com/mccarthyryanj/status/345188184633769984"><p>You should really sign up for the @digg email newsletter. It\'s great.</p><footer><b>Ryan McCarthy</b>&nbsp;<a href="https://twitter.com/mccarthyryanj/status/345188184633769984" target="_blank">@mccarthyryanj&nbsp;&nbsp;June 13, 2013, 7:37am</a></footer></blockquote>\n        \n        <% } else if (campaignVersion == 2) { %>\n            <blockquote class="tweet" cite="https://twitter.com/travors/status/393001208841252864"><p>The @digg newsletter is really good, in fact it\'s the only newsletter that always engages me.</p><footer><b>Dan Walsh</b>&nbsp;<a href="https://twitter.com/travors/status/393001208841252864" target="_blank">@travors&nbsp;&nbsp;Oct 13, 2013, 6:09am</a></footer></blockquote>\n            \n        <% } else if (campaignVersion == 3) { %>\n            <blockquote class="tweet" cite="https://twitter.com/BrianMueller333/status/350593250521919488"><p>Never thought I\'d look forward to receiving a daily newsletter from Digg, but here we are.</p><footer><b>Brian Mueller</b>&nbsp;<a href="https://twitter.com/BrianMueller333/status/350593250521919488" target="_blank">@BrianMueller333&nbsp;&nbsp;June 28, 2013, 5:35am</a></footer></blockquote>\n        \n        <% } %>\n        </div>\n    <% } %>\n        <form class="form-dailydigg-sub">\n            <label class="form-dailydigg-lbl">\n                <span class="lbl">Enter your email address</span>\n                <input class="form-dailydigg-input" type="email" placeholder="Enter your email address" value="<%= inputValue %>" required />\n            </label>\n            <button class="form-dailydigg-submit" type="submit">Subscribe</button>\n            <p class="calltoaction"><% if (email) { %>Hit the subscribe button<% } else { %>Enter your email, hit subscribe <% } %> and pat yourself on the back for making a great decision.</p>\n        </form>\n    </section>'}),define("bootstrap_modal",[],function(){}),define("bs/widgets/onboarding",["require","bs/core","bs/util/cookies","bs/util/xhr","bs/util/format","bs/util/helpers","bs/widgets/dailydiggsub","text!bs/templates/popover.html","text!bs/templates/onboard_firstdigg.html","text!bs/templates/onboard_firstsave.html","text!bs/templates/modal_dailydigg.html","bootstrap_modal","lodash"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function E(e,t){return Math.floor(Math.random()*(t-e+1))+e}function S(e){var t=$(e.target).closest(".modal"),r=$(e.target).hasClass("btn-modal-close"),i=$(e.target).hasClass("form-dailydigg-cancel"),s=$(e.target).is(".form-dailydigg-sub.success"),o=(new Date).valueOf()+31536e6;if(t.length===0||r||i||s)s?setTimeout(function(){g.modal("hide").remove()},1500):g.modal("hide").remove(),n.set({name:"digg_onboarding_dailydiggsub",value:1,expires:new Date(o)}),$(document).off("click touchend",S)}function x(t){var n=typeof t!="undefined"?$(t.target).closest(".popover"):$("body").closest(".popover"),r=typeof t!="undefined"?$(t.target).hasClass("btn-close"):!1,i=typeof t!="undefined"?$(t.target).hasClass("modal"):!1,s=typeof t!="undefined"?$(t.target).hasClass("modal-backdrop"):!1;if(i||s)return;if(n.length===0||r)$(y).removeClass("show-story-actions"),$(".popover:not(.nav-user .popover)").remove(),$(document).off("click touchend",x),e("bs/core").pubsub.off("story_actions","sitenav_auth_displayed",x),e("bs/core").pubsub.off("story_actions","savedstories_modal_displayed",x)}function T(t){S(t),e("bs/core").pubsub.fire("dailydigg_tweet_campaign_success",w[b]),e("bs/core").pubsub.off("modal_dailydigg","dailydigg_subscribe_success",T)}var p=h.template(u),d=h.template(a),v=h.template(f),m=h.template(l),g,y=".story-container",b,w=["@stevekovach","@mccarthyryanj","@travors","@BrianMueller333","noTweet"],N={dailyDiggModal:function(t){var n=e("bs/core").user.isLoggedIn()?e("bs/core").user.get("email"):!1,r={email:n?n:!1,inputValue:n?n:"",campaignVersion:E(0,5)},i=m(r);return t&&t.preventDefault&&t.preventDefault(),g=$(i).appendTo("body").modal({keyboard:!0,show:!0}),b=r.campaignVersion,o.init(),setTimeout(function(){$(".form-dailydigg-input").focus()},10),$(document).on("click touchend",S),e("bs/core").pubsub.fire("dailydigg_tweet_campaign_view",w[b]),e("bs/core").pubsub.on("modal_dailydigg","dailydigg_subscribe_success",T),!1},dailyDiggModalHash:function(t){var n=N.dailyDiggModal;window.location.hash==="#dailydigg"&&(e("bs/core").pubsub.one("daily_digg_modal",e("bs/core").pubsub.channels.user_auth,n),e("bs/core").user.isLoggedIn()||$(function(){N.dailyDiggModal(t)}))},firstDigg:function(t){var n=e("bs/core").user.getUser(),r=$("<div></div>"),i=p({popoverContent:d(n)});x(),r.replaceWith(i).appendTo(t.parents(".story-action")).fadeIn(160).parents(y).addClass("show-story-actions"),$(document).on("click touchend",x),e("bs/core").pubsub.on("story_actions","sitenav_auth_displayed",x),e("bs/core").pubsub.on("story_actions","savedstories_modal_displayed",x)},firstSave:function(t){var n=$("<div></div>"),r=p({popoverContent:v()});x(),n.replaceWith(r).appendTo("#nav-saved").fadeIn(160),t.parents(y).addClass("show-story-actions"),$(document).on("click touchend",x),e("bs/core").pubsub.on("story_actions","sitenav_auth_displayed",x),e("bs/core").pubsub.on("story_actions","savedstories_modal_displayed",x),e("bs/core").pubsub.fire("onboarding_firstsave")}};return N}),define("text!bs/templates/storyaction_auth.html",[],function(){return'<div class="arrow"></div>\n<div class="btn-close">&#x2716;</div>\n<div class="popover-content">\n    <strong>Sign in</strong>\n    <p>Please sign in to <span id="auth-story-action"><%= action %></span> a story.</p>\n    \n    <a id="btn-facebook-auth" class="btn-service-auth btn-facebook-auth" href="#fb"><div class="auth-ico"></div>Sign in</a>\n    <a id="btn-twitter-auth" class="btn-service-auth btn-twitter-auth" href="#twitter"><div class="auth-ico"></div>Sign in</a>\n    <a id="btn-google-auth" class="btn-service-auth btn-google-auth" href="#google"><div class="auth-ico"></div>Sign in</a>\n</div>'}),define("bs/util/user",["require","bs/core","bs/util/cookies","bs/util/validation","bs/util/xhr","bs/util/helpers","bs/widgets/onboarding","text!bs/templates/storyaction_auth.html","lodash"],function(e,t,n,r,i,s,o,u,a){function m(t){c=!1,f=t.user;if(!f.v||f.v!==e("bs/core").config.v){y(null,!0);return}e("bs/core").pubsub.fire(e("bs/core").pubsub.channels.user_auth,f)}function g(){p||(p=!0,FB.init({appId:e("bs/core").config.FB_APP_ID,status:!0,cookie:!0,oauth:!0,xfbml:!0}))}function y(e,t){var n=t?{url:"/session",data:{action:"refresh"}}:{};c||(c=!0,d.request(n).success(function(t){c=!1,e&&typeof e=="function"&&e(f)}).error(function(e){c=!1}))}function b(e){var t=typeof e!="undefined"?$(e.target).closest(".popover"):$("body").closest(".popover"),n=typeof e!="undefined"?$(e.target).hasClass("btn-close"):!1;if(t.length===0||n)h.$loginEl.fadeOut(160),$(document).off("click",b),$(".story-container").removeClass("show-story-actions")}function w(){e("bs/core").pubsub.one("site_nav_user_widget",e("bs/core").pubsub.channels.user_auth,function(e){var t=(new Date).valueOf()/1e3-~~h.get("date_signup")<900,r=n.get("digg_onboarding_dailydiggsub"),i=document.location.hash;(i.match("test-onboarding")||t&&r!=="1"&&!h.get("email_subscriber"))&&o.dailyDiggModal()}),$(document).off("click",".btn-facebook-auth",_).off("click",".btn-twitter-auth",D).off("click",".btn-google-auth",P),E()}function E(){var e=!!n.get("frontend.user");return e&&!f&&y(),e}function S(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"?t=s.createGlobalCallback(t):n!=="link"&&n!=="login"&&(t||(t=s.createGlobalCallback(w))),O(r,t),e("bs/core").pubsub.fire("twitter_auth_success",n)});return s.popWin("/session/twitter?cb="+r,"twitterSignin",{width:590,height:460}),!1}function x(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"?t=s.createGlobalCallback(t):n!=="link"&&n!=="login"&&(t||(t=s.createGlobalCallback(w))),T(r,t),e("bs/core").pubsub.fire("google_auth_success",n)});return s.popWin("/session/google?cb="+r,"googleSignin",{width:590,height:560}),!1}function T(e,t){e.oauth_refresh_token&&(document.getElementById("oauth_refresh_token").value=e.oauth_refresh_token),document.getElementById("oauth_access_token").value=e.oauth_access_token,document.getElementById("google_uid").value=e.google_uid,document.getElementById("google_name").value=e.google_name,document.getElementById("google_email").value=e.google_email,document.getElementById("google_expiration_date").value=e.expiration_date,t&&(document.getElementById("google_callback").value=t),document.getElementById("session_google").submit()}function N(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"&&(t=s.createGlobalCallback(t)),C(r,t),e("bs/core").pubsub.fire("pocket_auth_success",n)});return s.popWin("/session/pocket?cb="+r,"pocketAuth",{width:960,height:640}),!1}function C(e,t){document.getElementById("pocket_token").value=e.pocket_token,document.getElementById("pocket_user_name").value=e.pocket_user_name,t&&(document.getElementById("pocket_callback").value=t),document.getElementById("session_pocket").submit()}function k(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"&&(t=s.createGlobalCallback(t)),L(r,t),e("bs/core").pubsub.fire("readability_auth_success",n)});return s.popWin("/session/readability?cb="+r,"readabilityAuth",{width:960,height:640}),!1}function L(e,t){document.getElementById("readability_token").value=e.readability_token,document.getElementById("readability_secret").value=e.readability_secret,document.getElementById("readability_username").value=e.readability_username,t&&(document.getElementById("readability_callback").value=t),document.getElementById("session_readability").submit()}function A(e,t){document.getElementById("instapaper_token").value=e.token,document.getElementById("instapaper_secret").value=e.secret,document.getElementById("instapaper_username").value=e.username,t&&(document.getElementById("instapaper_callback").value=t),document.getElementById("session_instapaper").submit()}function O(e,t){document.getElementById("twitter_key").value=e.key,document.getElementById("twitter_secret").value=e.secret,document.getElementById("twitter_screen_name").value=e.screen_name,document.getElementById("twitter_user_id").value=e.user_id,document.getElementById("twitter_callback").value=t,document.getElementById("session_twitter").submit()}function M(e,t){var n=e.authResponse;document.getElementById("fb_access_token").value=n.accessToken,document.getElementById("fb_expires").value=n.expiresIn,t!=null&&(document.getElementById("facebook_callback").value=t),document.getElementById("session_facebook").submit()}function _(t){var n="Sign In";return t&&(t.stopPropagation(),t.preventDefault()),e("bs/core").pubsub.fire("fb_auth_click",n),g(),FB.getLoginStatus(function(t){t.authResponse?(h.loginFacebook(t,s.createGlobalCallback(w)),e("bs/core").pubsub.fire("fb_auth_success",n)):FB.login(function(t){t.authResponse&&(h.loginFacebook(t,s.createGlobalCallback(w)),e("bs/core").pubsub.fire("fb_auth_success",n))},{scope:"email,publish_actions,publish_stream"})}),!1}function D(t){var n="Sign In";return t&&(t.stopPropagation(),t.preventDefault()),e("bs/core").pubsub.fire("twitter_auth_click",n),h.initTwitterLogin(null,n),!1}function P(t){var n="Sign In";return t&&(t.stopPropagation(),t.preventDefault()),e("bs/core").pubsub.fire("google_auth_click",n),h.initGoogleLogin(null,n),!1}var f=null,l=null,c=!1,h,p=!1,d=new i.dataProvider({url:"/api/user.json",cache:!1,success:m}),v=a.template(u);return h={loginEl:null,isLoggedIn:E,get:function(e){return f&&e in f?f[e]:null},refresh:function(){E()&&y()},getUser:function(){return f},updateAccessToken:function(e){l=e},initFacebookLogin:function(){g(),h.isLoggedIn()&&FB.getLoginStatus(function(e){var t;e.authResponse&&(t=new i.dataProvider({url:"/api/user/token/update.json",type:"POST",data:{access_token:e.authResponse.accessToken}}),h.updateAccessToken(e.authResponse.accessToken),t.request())})},loginFacebook:M,initTwitterLogin:S,initGoogleLogin:x,initPocketAuth:N,initReadabilityAuth:k,authenticateInstapaper:A,authorized:function(t,n,r){return n=n||"Sign In",r=r||{},r.storyActionEl=r.storyActionEl||".story-action",h.$loginEl?h.$loginEl.empty().detach():h.$loginEl=$('<div id="story-action-auth" class="popover story-action-auth" style="display:none"></div>'),function(){var i=$(this),s=i.closest(r.storyActionEl),o=s.closest(".story-container");return E()?f?t.call(this,f):y(a.bind(t,this)):(e("bs/core").pubsub.fire("signin_tooltip_displayed",n),e("bs/core").pubsub.fire("auth_tooltip_displayed"),e("bs/core").pubsub.one("savedstories",e("bs/core").pubsub.channels.user_auth,a.bind(function(){$(document).off("click",b),h.$loginEl.fadeOut(160),y(a.bind(t,this))},this)),h.$loginEl.html(v({action:n})).appendTo(s).fadeIn(160),o.addClass("show-story-actions"),$(document).on("click",b),e("bs/core").pubsub.on("storyaction","sitenav_auth_displayed",b)),!1}}},window.fbAsyncInit=h.initFacebookLogin,h.isLoggedIn()||$(document).on("click",".btn-facebook-auth",_).on("click",".btn-twitter-auth",D).on("click",".btn-google-auth",P),$(function(){$("#session-forms").load("/session/forms")}),h}),define("modernizr",[],function(){return Modernizr}),define("bs/core",["bs/util/pubsub","bs/util/user","jquery","lodash","modernizr"],function(e,t,n,r,i){var s=window.BS||{};return s.extend=n.extend,s.pubsub||s.extend(s,{pubsub:e}),s.user||(s.extend(s,{user:t}),window.fbAsyncInit||(window.fbAsyncInit=require("bs/user").initFacebookLogin)),i.addTest("ipad",function(){return!!navigator.userAgent.match(/iPad/i)}),i.addTest("iphone",function(){return!!navigator.userAgent.match(/iPhone/i)}),i.addTest("ipod",function(){return!!navigator.userAgent.match(/iPod/i)}),i.addTest("appleios",function(){return i.ipad||i.ipod||i.iphone}),i.ipad&&(s.support={ipad_version_ready:new n.Deferred},window.ondevicemotion=function(e){if(navigator.platform.indexOf("iPad")!=-1){var t=1;e.acceleration&&(t+=window.devicePixelRatio),document.documentElement.className+=" ipad-v"+t,s.support.ipad_version_ready.resolve()}window.ondevicemotion=null}),i.addTest("positionfixed",function(){var e=document.createElement("div"),t=e.cloneNode(!1),n=!1,r=document.body||function(){return n=!0,document.documentElement.appendChild(document.createElement("body"))}(),s=r.style.cssText;r.style.cssText="padding:0;margin:0",e.style.cssText="position:fixed;top:42px",r.appendChild(e),r.appendChild(t);var o=e.offsetTop!==t.offsetTop;return r.removeChild(e),r.removeChild(t),r.style.cssText=s,n&&document.documentElement.removeChild(r),navigator.userAgent.match(/OS (\d)/i),o&&(!i.appleios||i.appleios&&RegExp.$1>=5)}),i.addTest("lastchild",function(){var e,t=["#modernizr-last-child li{display:block;width:100px;height:100px;}","#modernizr-last-child li:last-child{width:200px;}"],n=document.getElementsByTagName("head")[0]||function(){return document.documentElement.appendChild(document.createElement("head"))}(),r=document.body||function(){return document.documentElement.appendChild(document.createElement("body"))}(),i=document.createElement("ul"),s=document.createElement("li"),o=document.createElement("li"),u=document.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=t.join(""):u.appendChild(document.createTextNode(t.join(""))),n.appendChild(u),i.id="modernizr-last-child",i.appendChild(s),i.appendChild(o),r.appendChild(i),e=o.offsetWidth>s.offsetWidth,n.removeChild(u),r.removeChild(i),e}),function(e,t){t.support.touch="ontouchstart"in e}(this,this.jQuery),n.fn.k=function(e,t){return t===undefined&&(t="38,38,40,40,37,39,37,39,66,65"),this.each(function(){var r=[];n(this).keydown(function(i){r.push(i.keyCode),r.toString().indexOf(t)>=0&&(n(this).unbind("keydown",arguments.callee),e(i))})})},s}),define("bs/util/storyactions2",["require","bs/core","bs/util/cookies","bs/util/xhr","bs/util/format","bs/util/helpers","bs/widgets/onboarding","text!bs/templates/popover.html","text!bs/templates/onboard_firstdigg.html","text!bs/templates/onboard_firstsave.html","lodash"],function(e,t,n,r,i,s,o,u,a,f,l){function E(e){var t=(new Date).valueOf()+31536e6;$.extend(m,e),n.set({name:v,value:$.param(m),expires:new Date(t)})}function S(e){var n="http://api.digg.com/api/v1/redirect",r=$(this).closest(".digg-story-el"),i=r.data("contentId"),s=t.user.get("user_id"),o={url:this.href};i&&(o.content_id=i),s&&(o.user_id=s),navigator.mozApps&&window.locationbar.visible===!1&&(o.platform=1005,window.open([n,$.param(o)].join("?")));if(g==="mobile")o.platform=1005,window.location.href=[n,$.param(o)].join("?");else{if(this.target!=="_blank")return;window.open([n,$.param(o)].join("?"))}return!1}function x(e){var t={contentID:e.data("contentId"),diggUrlID:e.data("urlId"),category:e.data("category"),diggScore:e.data("diggScore"),tweets:e.data("tweets"),fbShares:e.data("fbShares"),diggs:e.data("diggs"),dugg:e.data("dugg"),read_later:e.data("read_later")};return t.diggScore=l.isString(t.diggScore)?parseInt(t.diggScore.replace(/,/g,""),10):t.diggScore,t.tweets=l.isString(t.tweets)?parseInt(t.tweets.replace(/,/g,""),10):t.tweets,t.fbShares=l.isString(t.fbShares)?parseInt(t.fbShares.replace(/,/g,""),10):t.fbShares,t.diggs=l.isString(t.diggs)?parseInt(t.diggs.replace(/,/g,""),10):t.diggs,t}function T(e,t){e.data(t)}function N(e){l.each(e,function(e,t){C(t,e)})}function C(e,t,n){var r=$(".story-"+e),s=$(".diggscore-"+e),o=$(".diggs-"+e),u=$(".tweets-"+e),a=$(".fb_shares-"+e),f=$(".digg-"+e),l=$(".save-"+e),c=s.parent(".story-score"),h=$(".diggs-label-"+e),v,m;T(r,{diggScore:t.digg_score,diggs:t.diggs,tweets:t.tweets,fbShares:t.fb_shares,dugg:t.dugg,read_later:t.read_later});if(!s||!s.size())return;t.digg_score>0&&c.hasClass("story-score-zero")?c.removeClass("story-score-zero"):t.digg_score===0&&c.addClass("story-score-zero"),h.length>0&&t.diggs===0?c.addClass("story-score-zero"):h.length>0&&t.diggs===1?(h.html("digg"),c.removeClass("story-score-zero")):h.length>0&&(h.html("diggs"),c.removeClass("story-score-zero")),o.html(i.intWithCommas(t.diggs)),u.html(i.intWithCommas(t.tweets)),a.html(i.intWithCommas(t.fb_shares)),s.html(i.intWithCommas(t.digg_score,!0)),!n&&t.hasOwnProperty("dugg")&&t.dugg&&(f.html("Dugg"),r.addClass(p)),!n&&t.hasOwnProperty("read_later")&&t.read_later&&(l.html("Saved"),r.addClass(d))}function k(e){var t=$(this),n=t.parents(h),i=x(n),s={content_id:i.contentID,digg_url_id:i.diggUrlID},o=i.dugg?"/api/digg/delete.json":"/api/digg/submit.json",u=new r.dataProvider({url:o,type:"POST",data:s,success:l.bind(L,this,t,i.contentID)});return u.request(),!1}function L(e,n,r){var i=document.location.hash,s=$(".story-"+n),u=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,a=r.data,f=t.user.getUser(),l=$("<div></div>"),c;C(n,a,!0),a.dugg?(t.pubsub.fire("digg_success",e,a,n),s.addClass(p),$(".digg-"+n).html("Dugg")):(t.pubsub.fire("digg_delete_success",e,a,n),s.removeClass(p),$(".digg-"+n).html("Digg"));if(i.match("test-onboarding")||a.dugg&&!m.dugg&&u)o.firstDigg(e),E({dugg:1})}function A(e){var t=$(this),n=t.parents(h),i=x(n),s=i.read_later?"/api/story/readlater/delete.json":"/api/story/readlater/add.json",o={content_id:i.contentID,digg_url_id:i.diggUrlID},u=new r.dataProvider({url:s,type:"POST",data:o,success:l.bind(O,this,t,i.contentID)});return u.request(),!1}function O(e,n,r){var i=document.location.hash,s=$(".story-"+n),u=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,a=r.data,f=$("<div></div>"),l;T(s,{read_later:a.read_later}),a.read_later?(s.addClass(d),$(".save-"+n).html("Saved"),t.pubsub.fire("add_reading_list_success",e,a,n)):(s.removeClass(d),$(".save-"+n).html("Save"),t.pubsub.fire("delete_reading_list_request",e,a,n));if(i.match("test-onboarding")||a.read_later&&!m.saved&&u)o.firstSave(e),E({saved:1})}function M(e){var n=$(this),r=n.hasClass("share-twitter")?"twitter":"facebook";return e.preventDefault(),t.pubsub.fire("story_share",r,n),r==="twitter"?!1:(s.popWin(this.href,null,{width:550,height:450}),!1)}function _(e){var t=$(this),n=t.data("shareContentId"),r=t.data("shareId"),i="share-details-"+n+"-"+r;$(".share-details-"+n).hide(),$("#"+i).show(),$(".story-trending-share-img-container-"+n).removeClass("current"),t.parent().addClass("current")}var c="digg-story-el",h=".digg-story-el",p="story-acted-dugg",d="story-acted-saved",v="saflags",m=n.get(v),g=n.get("preferred_view")||"desktop",y=l.template(u),b=l.template(a),w=l.template(f);return m=m?s.deparam(m):{},{submitDigg:k,addReadingList:A,renderStoryScores:N,redirectStoryLink:S,shareStory:M,showShareDetails:_}}),define("bs/util/storyscores",["bs/core","bs/util/xhr","bs/util/cookies"],function(e,t,n){function v(e){this.name=e,this.pollInterval=r,this.storyScores={},this.delta={},this.currentContentIDs=[],this.dataProvider=new t.dataProvider({url:"/api/story/scores.json?"+this.name,type:"POST",success:_.bind(h,this),error:p})}var r=3e5,i="story_scores:update",s="story_scores:error",o={},u={},a=[],f=function(e,t,n){if(!o[t]||!_.isEqual(o[t],e))u[t]=e,o[t]=e},l=function(t){u={},_.each(t.data,f),e.pubsub.fire(e.pubsub.channels.scores_update,u)},c=function(e,t,n){if(!this.storyScores[t]||!_.isEqual(this.storyScores[t],e))this.delta[t]=e,this.storyScores[t]=e},h=function(t){this.delta={},_.each(t.data,_.bind(c,this)),e.pubsub.fire(e.pubsub.channels.scores_update,this.delta)},p=function(t){e.pubsub.fire(e.pubsub.channels.scores_update_error,t)},d=new t.dataProvider({url:"/api/story/scores.json",type:"POST",success:l,error:p});return v.prototype={setPollInterval:function(e){return this.pollInterval=e,this},register:function(t){return Array.prototype.push.apply(this.currentContentIDs,t),this.currentContentIDs=_.uniq(this.currentContentIDs),this.dataProvider.isPolling()&&this.dataProvider.stopPolling(),e.features.polling_scores?e.user.isLoggedIn()&&this.dataProvider.startPolling(this.pollInterval,{data:{content_ids:this.currentContentIDs.join(",")}}):e.user.isLoggedIn()&&this.dataProvider.request({data:{content_ids:this.currentContentIDs.join(",")}}),this},deregisterAll:function(){return this.currentContentIDs=[],this.storyScores={},this}},{factory:function(e){return new v(e)},register:function(t){return Array.prototype.push.apply(a,t),a=_.uniq(a),d.isPolling()&&d.stopPolling(),e.features.polling_scores&&d.startPolling(r,{data:{content_ids:a.join(",")}}),o},deregister:function(e){a=_.difference(a,e)}}}),define("bs/util/scrollmonitor",["bs/core","jquery","lodash"],function(e,t,n){function i(e,r){var i=20,s=1e3/i,o=n.bind(this.monitor,this);typeof e=="string"&&(e=document.getElementById(e)),r||(r={}),this._el=e,this._lastScrollTop=0,this.direction=null,this.name=r.name||"scrollMonitor",r.pubsub&&(this.pubsub=r.pubsub),this.updateScrollHeight(),this._monitor=n.throttle(o,s),t(this._el).on("scroll",this._monitor)}var r=function(){var r=20;this.$win=t(window),this.$body=t(document.body),this.winHeight=this.$win.height(),this.scrollHeight=this.$body.height(),this.$win.scroll(n.throttle(n.bind(this.monitor,this),1e3/r))};return r.prototype={updateScrollHeight:function(){this.scrollHeight=this.$body.height()},updateWinHeight:function(){this.winHeight=this.$win.height()},monitor:function(){e.pubsub.fire(e.pubsub.channels.scrolltop,this.$win.scrollTop())}},e.scrollMonitor=new r,n.bindAll(e.scrollMonitor),i.prototype={data:function(){var e;return this.direction=this._el.scrollTop-this._lastScrollTop<0?"up":"down",e={el:this._el,scrollTop:this._el.scrollTop,scrollHeight:this._el.scrollHeight,direction:this.direction},e.scrollBottom=e.scrollTop+e.scrollHeight,e},isBottom:function(){var e=100;return this._el.offsetHeight+this._el.scrollTop+e>=this._el.scrollHeight},checkScrollDepth:function(e){return this._el.offsetHeight+this._el.scrollTop>=this._el.scrollHeight*e},updateScrollHeight:function(){this.scrollHeight=this._el.scrollHeight},monitor:function(){this.pubsub&&(this.pubsub.fire(this.name+":scroll",this.data()),this.checkScrollDepth(.5)&&this.pubsub.fire(this.name+":scroll:50%",this.data()),this.isBottom()&&this.pubsub.fire(this.name+":scroll:bottom",this.data())),this._lastScrollTop=this._el.scrollTop},destroy:function(){t(this._el).off("scroll"),this._el=null}},{factory:function(e,t){return new i(e,t)}}}),define("bs/util/pagesectionmonitor",["bs/core","bs/util/scrollmonitor"],function(e,t){var n=$("header.site-header").outerHeight(),r,i=[],s=!1,o={initialize:function(){e.pubsub.on("scroll",e.pubsub.channels.scrolltop,o.scrollTopHandler),e.pubsub.on("scroll","autoscroll_start",function(){s=!0}),e.pubsub.on("scroll","autoscroll_stop",function(){s=!1})},registerSection:function(e,t){var r={id:e,targClass:t};i.push(r),_.each(i,function(e){e.targTop=$("#"+e.id).offset().top-n}),i.sort(function(e,t){return e.targTop-t.targTop})},scrollTopHandler:function(t){var n=10,o;if(s)return;o=_.filter(i,function(e){return e.targTop>=t+n}),r!==o.length&&(e.pubsub.fire("page_section_change",o.length),r=o.length)},updateBodyClass:function(e){var t=_.pluck(i,"targClass").reverse(),n=$("body"),r;e>=t.length&&(e=t.length-1),r=t[e],n.hasClass(r)||n.removeClass(t.join(" ")).addClass(r)}};return o}),define("bs/util/tracking",["bs/core","jquery","lodash"],function(e,t,n){function r(e){var t=e.match(/:\/\/(.[^\/]+)/);return t?t[1]:null}function i(e){var t;return e?(t=e.split("-"),t[0].charAt(0).toUpperCase()+t[0].substring(1)):""}function s(e){window.location.href=e}function o(e){e.submit()}function u(e){var t=e.closest("[data-tracking-category]"),s=e.data("contenturl")||e.attr("href"),o=r(s),u=e.parents(".stories-container"),a=u.attr("id"),f=i(a),l=e.data("position"),c=["Tag","Source","Search"],h={};return t.length?(h={Category:t.data("tracking-category"),Section:t.data("tracking-action"),"Location ID":l,URL:s,Domain:o},n.indexOf(c,h.Category)>-1&&(h.isArchiveStory=!0)):h={Category:"",Section:f,"Location ID":l,URL:s,Domain:o},h}function a(){this.debug=!1}var f=function(){var e=this;t(document).on("click",".story-link",function(n){var r=t(this),i=" Click",s=u(r),o;return s.isArchiveStory?o=[s.Category+" Page"+i,s.Section+i,s.URL]:o=[s.Section+i,"Position "+s["Location ID"],s.URL],e.trackEvent.apply(e,o)})},l=function(){var t=this;e.pubsub.on("tracking","digg_success",function(e){var n=e.closest(".digg-story-el"),r="Diggs",i=" Digg",s=u(n),o;return s.isArchiveStory?o=[r,s.Category+i,s.URL]:o=[r,s.Section+i,s.URL],t.trackEvent.apply(t,o)})},c=function(){var t=this;e.pubsub.on("tracking","add_reading_list_success",function(e){var n=e.closest(".digg-story-el"),r="Saves",i=" Save",s=u(n),o;return s.isArchiveStory?o=[r,s.Category+i,s.URL]:o=[r,s.Section+i,s.URL],t.trackEvent.apply(t,o)})},h=function(){var t=this,n="Daily Digg Email Submit";e.pubsub.on("tracking","daily_digg_email_submit_start",function(e){return t.trackEvent(n,"Email Address entered")}),e.pubsub.on("tracking","daily_digg_email_submit_success",function(e){return t.trackEvent(n,"Email Address submission complete")})},p=function(){var n=this;e.pubsub.on("tracking","story_share",function(e,t){var r=e==="twitter"?"Twitter Shares":"Facebook Shares",i=e==="twitter"?" Twitter Share":" Facebook Share",s=u(t),o;return s.isArchiveStory?o=[r,s.Category+i,s.URL]:o=[r,s.Section+i,s.URL],n.trackEvent.apply(n,o)}),t(document).on("click",".btn-tweet-reply",function(e){var r=t(this),i="Twitter Shares",s=" Twitter Reply",o=u(r);return n.trackEvent(i,o.Section+s,o.URL)}).on("click",".btn-tweet-retweet",function(e){var r=t(this),i="Twitter Shares",s=" Twitter Retweet",o=u(r);return n.trackEvent(i,o.Section+s,o.URL)}).on("click",".btn-tweet-favorite",function(e){var r=t(this),i="Twitter Shares",s=" Twitter Favorite",o=u(r);return n.trackEvent(i,o.Section+s,o.URL)})},d=function(){var t=this;e.pubsub.on("tracking","signin_tooltip_displayed",function(e){var n="Sign in attempt",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","fb_auth_click",function(e){var n="Click Facebook Auth",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","fb_auth_success",function(e){var n="Facebook Auth Complete",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","twitter_auth_click",function(e){var n="Click Twitter Auth",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","twitter_auth_success",function(e){var n="Twitter Auth Complete",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","google_auth_click",function(e){var n="Click Google Auth",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","google_auth_success",function(e){var n="Google Auth Complete",r="on "+e;return t.trackEvent(n,r)}),e.pubsub.on("tracking","dailydigg_signup",function(e){var n="Email Signup",r="on "+e.source_action,i="via "+e.network;return t.trackEvent(n,r,i)})},v=function(){e.pubsub.on("tracking","dailydigg_tweet_campaign_view",function(e){return C.trackEvent("Daily Digg Signup Modal","Tweet Campaign View",e)}),e.pubsub.on("tracking","dailydigg_tweet_campaign_success",function(e){return C.trackEvent("Daily Digg Signup Modal","Tweet Campaign Success",e)})},m=function(){var e=this;t(document).on("click",".ftr-ios-link",function(t){return e.trackEvent("Click Digg for iPhone","Footer")})},g=function(){var n=this;t(document).on("click","#btn-hdr-submit-link",function(e){return n.trackEvent("Submit a Link","Footer")}),e.pubsub.on("tracking","submit_link_pasted",function(){return n.trackEvent("Submit a Link","Paste Link")}),e.pubsub.on("tracking","submit_link_fb_auth",function(){return n.trackEvent("Submit a Link","Auth with Facebook")})},y=function(){var t=this;e.pubsub.on("tracking","fb_enable_og_update",function(e){var n=e?"on":"off";return t.trackEvent("Toggle Timeline Sharing","Turn "+n)})},b=function(){var t=this;e.pubsub.on("tracking","homepage_section_view",function(e){var n=i(e);return t.trackEvent("Homepage Section View",n)})},w=function(){var t=this;e.pubsub.on("tracking","homepage_topnav_section_click",function(e){return t.trackEvent("Homepage Top Nav Section Click",e)})},E=function(){var t=this;e.pubsub.on("tracking","spreadgun",function(e){return t.trackEvent("Konami!",e)})},S=function(){var t=this;e.pubsub.on("tracking","story_score_details_displayed",function(){return t.trackEvent("Digg Score Tooltip","Displayed")})},x=function(){function r(t,r){var i={twitter:"Twitter",fb:"Facebook",gplus:"G+"};return e.trackEvent(n,t,i[r])}function i(e){var t=/digg-social-(twitter|fb|gplus)/,n=t.exec(this.className)[1];return r("Header",n)}function s(e){var n=t(this).data("type");return r("Footer",n)}var e=this,n="Click on Social Button";t(document).on("click",".digg-social-icon",i).on("click",".footer-social-link",s)},T=function(){var e=this;t(function(){t("#form-digg-search").on("submit",function(r){var i=t(this).find("input[name=q]").val();n.delay(o,400,this),e.trackEvent("Search","Header",i)}),t("#search-page-form").on("submit",function(r){var i=t(this).find("input[name=q]").val();n.delay(o,400,this),e.trackEvent("Search","Search Page",i)})})},N=function(){var e=this;t(document).on("click",".tag-list-item-link",function(n){n.preventDefault(),setTimeout(function(){window.location.href=n.target.href},400);var r=t("article"),i=u(r);return e.trackEvent("Tag Navigation Click","From "+i.Section,"To "+n.target.text)}).on("click",".story-tag-link",function(n){n.preventDefault(),setTimeout(function(){window.location.href=n.target.href},400);var r=t(this),i=u(r),s=t("body").hasClass("homepage");return s?e.trackEvent("Archive Click","Tag Click",r.attr("href")):e.trackEvent("Pivot Click","Source Click",r.attr("href"))}).on("click",".story-source-link",function(n){n.preventDefault(),setTimeout(function(){window.location.href=n.target.href},400);var r=t(this),i=u(r),s=t("body").hasClass("homepage");return s?e.trackEvent("Archive Click","Source Click",r.attr("href")):e.trackEvent("Pivot Click","Source Click",r.attr("href"))})};_setupPivotPaginationClickHandler=function(){var e=this,n,r;t(document).on("click",".btn-more-stories",function(n){var i=t(this),s=i.closest("[data-tracking-category]"),o=s.data("tracking-category"),u=s.data("tracking-action"),a=~~i.data("incrementor");return a+=1,i.data("incrementor",a),r="Page "+a.toString(),e.trackEvent("Archive Pagination Depth",r,o+" "+u)})},a.prototype={initialize:function(){f.call(this),l.call(this),c.call(this),p.call(this),x.call(this),b.call(this),w.call(this),d.call(this),m.call(this),y.call(this),g.call(this),S.call(this),E.call(this),h.call(this),N.call(this),_setupPivotPaginationClickHandler.call(this),T.call(this),v.call(this)},trackEvent:function(){var e=Array.prototype.slice.call(arguments).reverse();return e.push("_trackEvent"),window._gaq.push(e.reverse()),this.debug&&console.log("tracking",e),!0}};var C=new a;t(n.bind(C.initialize,C))}),define("bs/widgets/lazyimages",["jquery","bs/core","bs/util/scrollmonitor"],function(e,t,n){function u(t){var n=e(t),r=e(t).data("src");r=r!==o?r:o,n.attr("src",r)}function a(t){var n=e(t),r=e(t).data("src");r=r!==o?o:r,n.attr("src",r)}function f(){var e=s,t=c(),n=e*2+t,o=t-e*2;for(var f=i.length-1;f>=0;f-=1)if(i[f].offset<n&&i[f].offset>o&&!i[f].loaded)u(i[f].el),i[f].loaded=!0;else if(r.garbageCollection&&i[f].offset>n||r.garbageCollection&&i[f].offset<o&&i[f].loaded)a(i[f].el),i[f].loaded=!1}function l(){var e=document.documentElement.clientHeight||window.innerHeight;return s=e,e}function c(){var e=document.documentElement.scrollTop||document.body.scrollTop;return e}function h(e){var t=0;if(e.offsetParent)do t+=e.offsetTop,e=e.offsetParent;while(e&&e.nodeName!=="BODY");return t}function p(){var t,n=e(".lazy-image-img");for(var r=n.length-1;r>=0;r-=1)e(n[r]).hasClass("need-offset")&&(e(n[r]).removeClass("need-offset").addClass("got-offset"),i.push({el:e(n[r]),offset:h(n[r]),loaded:!1}))}function d(){Modernizr.touch&&e(window).on("touchend",function(){f()}),t.pubsub.on("scroll",t.pubsub.channels.scrolltop,f),e(window).on("resize",function(){l(),f()}),window.addEventListener&&window.addEventListener("orientationchange",function(){l(),f()},!1),t.pubsub.on("storystream","render_stories",function(){p(),f()})}var r={garbageCollection:!1},i=[],s=document.documentElement.clientHeight||window.innerHeight,o="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";return{init:function(e){r=e?e:r,p(),f(),i.length>0&&d()}}}),define("text!bs/templates/user_auth.html",[],function(){return'<div id="nav-user-auth" class="nav-user-auth">\n    <a id="btn-facebook-auth-topnav" class="btn-service-auth btn-facebook-auth" href="#fb">\n      <div class="auth-ico"></div>\n      Sign in with Facebook\n    </a>\n    <a id="btn-twitter-auth-topnav" class="btn-service-auth btn-twitter-auth" href="#twitter">\n      <div class="auth-ico"></div>\n      Sign in with Twitter\n    </a>\n    <a id="btn-google-auth-topnav" class="btn-service-auth btn-google-auth" href="#google">\n      <div class="auth-ico"></div>\n      Sign in with Google\n    </a>\n</div>'}),define("text!bs/templates/user_nav.html",[],function(){return'<div id="nav-user-nav" class="nav-user-nav">\n    <ul class="popover-list">\n        <li class="popover-list-item"><a class="popover-list-link" href="/settings">Settings</a></li>\n        <li class="popover-list-item"><a class="popover-list-link" href="/logout">Sign Out</a></li>\n    </ul>\n</div>'}),define("bs/widgets/usernav",["bs/core","text!bs/templates/popover.html","text!bs/templates/user_auth.html","text!bs/templates/user_nav.html","lodash"],function(e,t,n,r,i){function h(t){var n=typeof t!="undefined"?$(t.target).closest(".popover"):$("body").closest(".popover");l&&n.length===0&&($(document).off("click touchend",h),e.pubsub.off("usernav","auth_tooltip_displayed",h),s.removeClass("usernav-active"),o.removeClass(c),l=!1)}function p(t){l?h(t):(s.addClass("usernav-active"),o.addClass(c),l=!0,$(document).on("click touchend",h),e.pubsub.on("usernav","auth_tooltip_displayed",h),e.pubsub.fire("sitenav_auth_displayed"),e.pubsub.fire("hide_onboarding_popovers"));if($(t.target).hasClass("nav-link"))return!1}function d(t){e.pubsub.off("site_nav_user_widget",e.pubsub.channels.user_auth,m)}function v(){o.addClass("widget-active").append(u({popoverContent:a()}))}function m(t){o.addClass("widget-active").html('<a class="nav-link" href="#" title="'+t.name+'">'+t.name+"</a>"+u({popoverContent:f()})),s.addClass("authenticated"),h(),e.pubsub.off("site_nav_user_widget",e.pubsub.channels.user_auth,m)}function g(){var t=e.user.get("name");o.find(".nav-link").attr("title",t).html(t)}var s=$("#digg-header"),o=$("#nav-user"),u=i.template(t),a=i.template(n),f=i.template(r),l=!1,c="show-popover";return{init:function(){e.user.isLoggedIn()?$(function(){g()}):(v(),e.pubsub.one("site_nav_user_widget",e.pubsub.channels.user_auth,m)),$(document).on("click","#nav-user",p),e.pubsub.on("usernav","savedstories_modal_displayed",h),e.pubsub.on("usernav","onboarding_firstsave",h)}}}),define("bs/util/storyactions",["require","bs/core","bs/util/cookies","bs/util/xhr","bs/util/format","bs/util/helpers"],function(e,t,n,r,i,s){function f(e){var t=(new Date).valueOf()+31536e6;$.extend(u,e),n.set({name:o,value:$.param(u),expires:new Date(t)})}function l(e){var n="http://api.digg.com/api/v1/redirect",r=$(this).closest(".digg-story-el"),i=r.data("contentId"),s=t.user.get("user_id"),o={url:this.href};return e&&e.preventDefault(),i&&(o.content_id=i),s&&(o.user_id=s),navigator.mozApps&&window.locationbar.visible===!1&&(o.platform=1005,window.open([n,$.param(o)].join("?"))),a==="mobile"?(o.platform=1005,window.location.href=[n,$.param(o)].join("?")):this.target==="_blank"?window.open([n,$.param(o)].join("?")):window.location.href=this.href,!1}function c(e){$("#topnav-onboarding-dailydigg-signup").hide(),$("#dugg-success-container").hide(),$("#saved-success-container").hide(),$(document).off("click",c),$(".story-container").off("mouseleave",c),$(".story-row").off("mouseleave",c)}function h(e,t,n){var r=$(".btn-story-action-"+t+"-"+e),i=["webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","msTransitionEnd","transitionend"].join(" "),s;Modernizr.csstransitions?(!n&&r.hasClass("btn-story-acted")&&r.parent().removeClass("btn-container-acted"),s=_.bind(function(e){n?r.addClass("btn-rotated"):r.removeClass("btn-rotated"),r.hasClass("btn-rotated")&&r.parent().addClass("btn-container-acted"),r.off(i,s)},this),r.on(i,s),n?r.addClass("btn-story-acted"):r.removeClass("btn-story-acted"),t!=="digg"&&(r.hasClass("btn-story-acted")?r.parent().css("visibility","visible"):r.parent().css("visibility","hidden"))):!n&&r.hasClass("btn-story-acted")?(r.parent().removeClass("btn-container-acted"),r.find(".btn-story-action-off").animate({top:"0px"},300),r.find(".btn-story-action-on").animate({top:"31px"},300,function(){r.removeClass("btn-story-acted")})):n&&!r.hasClass("btn-story-acted")&&(r.find(".btn-story-action-off").animate({top:"-31px"},300),r.find(".btn-story-action-on").animate({top:"0px"},300,function(){r.addClass("btn-story-acted"),r.parent().addClass("btn-container-acted")}))}function p(e){var t={contentID:e.data("contentId"),diggUrlID:e.data("urlId"),category:e.data("category"),diggScore:e.data("diggScore"),tweets:e.data("tweets"),fbShares:e.data("fbShares"),diggs:e.data("diggs")};return t.diggScore=_.isString(t.diggScore)?parseInt(t.diggScore.replace(/,/g,""),10):t.diggScore,t.tweets=_.isString(t.tweets)?parseInt(t.tweets.replace(/,/g,""),10):t.tweets,t.fbShares=_.isString(t.fbShares)?parseInt(t.fbShares.replace(/,/g,""),10):t.fbShares,t.diggs=_.isString(t.diggs)?parseInt(t.diggs.replace(/,/g,""),10):t.diggs,t}function d(e,t){e.data(t)}function v(e,n,r){var i=r.data,s,o=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,a;d(e,{diggScore:i.digg_score,diggs:i.diggs,tweets:i.tweets,fbShares:i.fb_shares}),t.pubsub.fire("digg_success",e,i,n);if(!u.dugg||o)f({dugg:1}),s=$("#dugg-success-container").appendTo(e.closest(".btn-story-action-container")).fadeIn(100),t.user.get("facebook")?(s.find(".dugg-success-fb-message").show(),s.find(".dugg-success-twitter-message").hide()):(s.find(".dugg-success-fb-message").hide(),s.find(".dugg-success-twitter-message").show()),o&&!t.user.get("email_subscriber")?($("#onboarding-dailydigg-signup").data("sourceAction","Digg").show().appendTo(s),a=t.user.get("email"),a&&($(".dailydigg-email").val(a),$("#onboarding-dailydigg-signup").find(".btn-dailydigg-no").css("visibility","visible")),s.addClass("dailydigg-signup-active")):($(document).on("click",c),e.parents(".story-container").on("mouseleave",c),e.parents(".story-row").on("mouseleave",c)),$(".tooltip").on("click",".btn-close",c)}function m(e){var t="/api/digg/submit.json",n=$(this),s=n.closest(".digg-story-el"),o=p(s),u=o.contentID,a=o.diggUrlID,f=$(".btn-story-action-on .story-score-"+u),l=o.diggScore,c=$(".story-score-thumb-"+u),m=o.diggs,y,b,w=l+1,E=m+1;return n.parent().hasClass("btn-story-acted")?(g.call(this),!1):(h(u,"digg",!0),f.size()&&(f.html(i.intWithCommas(w,!0)),c.html(i.intWithCommas(E)),d(s,{diggScore:w,diggs:E})),b={content_id:u},o.category&&(b.category=o.category),o.diggUrlID&&(b.digg_url_id=o.diggUrlID),y=new r.dataProvider({url:t,type:"POST",data:b,success:_.bind(v,this,n,u)}),y.request(),!1)}function g(e){var s="/api/digg/delete.json",o=$(this),u=o.closest(".digg-story-el"),a=p(u),f=a.contentID,l=$(".btn-story-action-off .story-score-"+f),c=a.diggScore,v=$(".story-score-thumb-"+f),m=a.diggs,g=0,y=0,b;return g=c-1<0?0:c-1,y=m-1<0?0:m-1,l.size()&&(l.html(i.intWithCommas(g,!0)),v.html(i.intWithCommas(y)),d(u,{diggScore:g,diggs:y})),h(f,"digg",!1),b=new r.dataProvider({url:s,type:"POST",data:{content_id:f,_xsrf:n.get("_xsrf")},success:function(e){var n=e.data;d(o,{diggScore:n.digg_score,diggs:n.diggs,tweets:n.tweets,fbShares:n.fb_shares}),t.pubsub.fire("digg_delete_success",o,n,f)}}),b.request(),!1}function y(e,n,r){var i,s,o=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,a;if(e.hasClass("btn-deleted-undo")){i=e.parents(".story-row"),i.removeClass("story-row-deleted"),i.find(".btn-score-action-readlater-delete").removeClass("btn-score-action-readlater-delete"),i.find(".timestamp, .story-actions-cell").show(),i.find(".deleted-label, .deleted-undo").remove();return}t.pubsub.fire("add_reading_list_success",e);if(!u.saved||o)f({saved:1}),s=$("#saved-success-container").appendTo("#saved-stories-container").fadeIn(100),o&&!t.user.get("email_subscriber")?($("#onboarding-dailydigg-signup").data("sourceAction","Save").appendTo(s).show(),a=t.user.get("email"),a&&($(".dailydigg-email").val(a),$("#onboarding-dailydigg-signup").find(".btn-dailydigg-no").css("visibility","visible"))):$(document).on("click",c)}function b(e,n,r){var i;t.pubsub.fire("delete_reading_list_success",e);if(e.closest(".saved-story-row").size()>0)return i=e.closest(".story-row"),i.addClass("story-row-deleted"),i.find(".timestamp, .story-actions-cell").hide(),i.append("<td class='deleted-label'>deleted</td>"),i.append("<td class='deleted-undo'><a href='#undo' class='btn-deleted-undo' data-content-id='"+n+"'>Undo</a></td>"),!1}function w(e){var t=$(this),n=t.data("contentId"),i,s,o="/api/story/readlater/add.json",u;return t.hasClass("btn-story-acted")?(t.hasClass("btn-story-action-delete-save")||E.call(this),!1):(n||(storyEl=t.closest(".digg-story-el"),n=storyEl.data("contentId"),i=storyEl.data("urlId"),s=storyEl.data("category")),t.removeClass("btn-score-action-readlater-delete"),h(n,"save",!0),data={content_id:n},s&&(data.category=s),i&&(data.digg_url_id=i),u=new r.dataProvider({url:o,type:"POST",data:data,success:_.bind(y,this,t,n)}),u.request(),!1)}function E(e){var i=$(this),s=i.data("contentId"),o="/api/story/readlater/delete.json",u;return s||(s=i.closest(".digg-story-el").data("contentId")),t.pubsub.fire("delete_reading_list_request",i),i.hasClass("btn-story-action-delete-save")||h(s,"save",!1),u=new r.dataProvider({url:o,type:"POST",data:{content_id:s,_xsrf:n.get("_xsrf")},success:_.bind(b,this,i,s)}),u.request(),!1}function S(e){_.each(e,function(e,t){var n,r;T(t,e),e.dugg&&(n=$(".story-"+t).find(".btn-story-action-digg"),h(t,"digg",!0)),e.read_later&&(r=$(".story-"+t).find(".btn-story-action-save"),h(t,"save",!0))})}function x(e){return e.replace(/,/g,"")}function T(e,t){var n=$(".story-"+e),r=$(".story-score-"+e),s,o,u,a,f,l,c;d(n,{diggScore:t.digg_score,diggs:t.diggs,tweets:t.tweets,fbShares:t.fb_shares});if(!r||!r.size())return;s=$(".story-score-thumb-"+e),o=$(".story-score-tweets-"+e),u=$(".story-score-fb_shares-"+e),r.html(i.intWithCommas(t.digg_score,!0)),s.html(i.intWithCommas(t.diggs)),o.html(i.intWithCommas(t.tweets)),u.html(i.intWithCommas(t.fb_shares))}function N(e){var n,r;return e.preventDefault(),n=$(this),r=n.html().indexOf("Tweet")>-1?"twitter":"facebook",t.pubsub.fire("story_share",r,n),r==="twitter"?!1:(s.popWin(this.href,null,{width:530,height:350}),!1)}function C(e){var t=$(this),n=t.data("shareContentId"),r=t.data("shareId"),i="share-details-"+n+"-"+r;$(".share-details-"+n).hide(),$("#"+i).show(),$(".story-trending-share-img-container-"+n).removeClass("current"),t.parent().addClass("current")}function k(){$(".btn-story-action-container-share").removeClass("show"),$(document).off("click",k),$(".story-container").off("mouseleave",k),$(".story-row").off("mouseleave",k)}function L(e){var t=$(this);return $("#facebook-auth-container").hide(),t.closest(".btn-story-action-container-share").addClass("show"),$(document).on("click",k),t.closest(".story-container").on("mouseleave",k),t.closest(".story-row").on("mouseleave",k),t.closest(".story-community").on("mouseleave",k),!1}function A(e){$(this).parent().remove()}function O(e){return e.stopPropagation(),e.preventDefault(),$(this).closest(".btn-story-action-container-digg").addClass("show-score-details"),t.pubsub.fire("story_score_details_displayed"),!1}function M(e){$(this).closest(".btn-story-action-container-digg").removeClass("show-score-details")}var o="saflags",u=n.get(o),a=n.get("preferred_view")||"desktop";return u=u?s.deparam(u):{},t.pubsub.on("story_actions","auth_tooltip_displayed",k),t.pubsub.on("story_actions","hide_success_tooltips",c),{submitDigg:m,deleteDigg:g,addReadingList:w,deleteReadingList:E,renderStoryScores:S,redirectStoryLink:l,shareStory:N,showShareDetails:C,showShareToolTip:L,showScoreDetails:O,hideScoreDetails:M,hideSuccessToolTips:c}}),define("text!bs/templates/story_saved.html",[],function(){return'<article class="story-container story-<%= content.content_id %> digg-story-el" data-content-id="<%= content.content_id %>" data-contenturl="<%=content.url%>" data-position="<%=position%>" data-diggs="<%= diggs.count %>" data-tweets="<%= tweets.count %>" data-fb-shares="<%= fb_shares.count %>" data-digg-score="<%= digg_score %>">\n    <% if (typeof image != \'undefined\') { %>\n    <div class="story-image">\n        <a data-position="<%=position%>" data-content-id="<%= content.content_id %>" class="story-link" href="<%= content.url %>" target="<%=content.link_target%>">\n            <img class="story-image-img" src="<%= image.url %>" width="<%= image.width %>" height="<%= image.height %>" alt="" />\n        </a>\n    </div>\n    <% } %>\n    <div class="story-content">\n        <header class="story-header">\n            <div class="story-kicker"><%= content.kicker %></div>\n            <h2 class="story-title entry-title">\n                <a class="story-title-link story-link" href="<%= content.url %>" target="<%=content.link_target%>"><%= content.title ? content.title.replace(/(\\S+) (\\S+)$/, "$1&nbsp;$2") : "" %></a>\n            </h2>\n            <div class="story-meta">\n            <% if (content.domain_name != \'YouTube\') { %>\n                <span class="story-meta-item story-source">\n                    <% if (content.domain_name === \'Digg Top Stories\') { %>\n                        <a itemprop="publisher copyrightHolder sourceOrganization provider" class="story-meta-item-link story-source-link" href="/source/<%= content.domain %>"><%= content.domain %></a>\n\n                    <% } else { %>\n                        <%= content.domain_name %>\n\n                    <% } %>\n                </span>\n            <% } %>\n            <% if (content.tags && content.tags.length) { %>\n                <% for (var i = 0, j = content.tags.length; i < j; i++) { %>\n                    <span class="story-meta-item story-tag<% if (i === 0) { %> first-tag<% } %>">\n                        <a itemprop="keywords" class="story-meta-item-link story-tag-link" href="/tag/<%= content.tags[i].slug %>"><%= content.tags[i].display %></a>\n                    </span>\n                <% } %>\n            <% } %>\n            <% if (date !== null) { %><abbr class="published story-meta-item story-timestamp"><time><%= formattedDate %></time></abbr><% } %>\n            </div>\n        </header>\n    </div>\n    <ul class="story-actions">\n        <li class="story-action story-action-digg btn-story-action-container"><a class="target digg-<%= content.content_id %>" href="#">Digg</a></li>\n        <li class="story-action story-action-save btn-story-action-container"><a class="target save-<%= content.content_id %>" href="#">Save</a></li>\n        <li class="story-action story-action-share"><a class="target share-facebook" href="<%= fblink %>">Facebook</a></li>\n        <li class="story-action story-action-share"><a class="target share-twitter" href="<%= tweetlink %>">Twitter</a></li>\n    </ul>\n</article>\n'}),define("text!bs/templates/saved_nav.html",[],function(){return'<li id="saved-stories-container" class="nav-item nav-saved"><a class="nav-link" href="#savedstories" id="btn-savedstories">Saved <sup id="savedstories-new-count" class="savedstories-none"><%= savedStoryCount %></sup></a></li>'}),define("text!bs/templates/reader/feed_zero_saved.html",[],function(){return'<div class="zero-items-message">\n    <h2 class="zero-items-message-hed">You haven’t saved anything yet.</h2>\n    <p>Click the <span class="save-icon">SAVE ICON</span> to save an item here.</p>\n</div>\n'}),define("bs/widgets/savedstories2",["bs/core","bs/util/xhr","bs/util/format","bs/util/storyactions","bs/util/storyscores","text!bs/templates/story_saved.html","text!bs/templates/saved_nav.html","text!bs/templates/reader/feed_zero_saved.html","bootstrap_modal","lodash"],function(e,t,n,r,i,s,o,u,a,f){function E(t){var r=[""],i=[];t.length===0?b.html(y):($("#btn-savedstories-more").remove(),f.each(t,function(t,s){t.view="saved",t.position=s,t.content.link_to_publisher=!0,t.content.link_target=t.content.link_to_publisher?"_blank":"_self",t.content.title=t.content.title_alt?t.content.title_alt:t.content.title,t.formattedDate=n.secondsToFuzzyTime(t.date),t.tweetlink="https://twitter.com/intent/tweet?url=http://on.digg.com/"+t.content.content_id+"&via=Digg&text="+encodeURIComponent(t.content.title),t.fblink="https://www.facebook.com/dialog/feed?display=popup&app_id="+e.config.FB_APP_ID+"&link=http://on.digg.com/"+t.content.content_id+"&redirect_uri=http://digg.com/fbshare",i.push(t.content.content_id),r.push(m(t))}),p!=="-1"&&r.push('<div id="btn-savedstories-more" class="btn-action">Load more...</div>'),b.append(r.join("")).parents(".modal").removeClass("loading"),h=l.find(".modal-body").get(0).scrollHeight,e.pubsub.fire("savedstories_rendered",i)),b.parents(".modal").removeClass("loading")}function S(){var e=new t.dataProvider({url:"/api/readlater/stats.json",success:function(e){v=e.data["new"],$("#nav-user").before(g({savedStoryCount:v})),v>0&&$("#savedstories-new-count").removeClass("savedstories-none")}});e.request()}function x(){var e=$("#savedstories-new-count"),n=new t.dataProvider({url:"/api/readlater/stats.json",success:function(t){v=t.data["new"],e.html(v),v>0&&e.removeClass("savedstories-none")}});n.request()}function T(e){var t=$("#savedstories-new-count"),n=~~t.html()||0;n+=e,n>0?t.removeClass("savedstories-none"):t.addClass("savedstories-none"),t.html(n)}function N(e,t,n){return $(".story-"+n).addClass("story-deleted").find(".save-"+n).text("Undo"),!1}function C(e,t,n){return $(".story-"+n).removeClass("story-deleted").find(".save-"+n).text("Saved"),!1}var l,c,h,p,d,v=0,m=f.template(s),g=f.template(o),y=f.template(u),b=$("#modal-savedstories-container"),w=new t.dataProvider({url:"/api/readlater.json",cache:!1,success:function(e){c=e.data.feed,p=e.data.next_position,d=e.data.total_count,E(c)},error:function(e){b.html("<div class='stories-error'>There was a problem loading Saved stories. <br/>We're working on a fix. Wait a moment and try again.</div>")}});e.pubsub.on("saved_stories","add_reading_list_success",function(){T(1)}),e.pubsub.on("saved_stories","delete_reading_list_request",function(){T(-1)});var k={initialize:function(t){e.user.isLoggedIn()?x():e.pubsub.one("savedstories",e.pubsub.channels.user_auth,S),l=$(t.elID).modal({keyboard:!0,show:!1}),e.pubsub.on("story_scores","savedstories_rendered",function(e){var t=i.factory("saved_stories_"+(new Date).valueOf());t.register(e)}),$(document).on("click touchend","#btn-savedstories",k.show).on("click touchend","#btn-savedstories-modal-close",k.hide).on("click touchend",".btn-deleted-undo",C).on("click touchend","#btn-savedstories-more",function(){$(this).addClass("loading").html('<span class="loading-txt">Loading ...</span>'),w.request({data:{position:p}})})},show:function(){var t=Math.floor($(window).height()*.8),n=l.find(".modal-body"),r;return l.addClass("loading").css({height:t+"px",marginTop:"-"+Math.floor(t/2)+"px"}).modal("show"),n.height(t-l.find(".modal-header").height()-100+"px"),w.request(),$(document).on("click touchend",k.hide),e.pubsub.on("savedstories_list","delete_reading_list_request",N),e.pubsub.on("savedstories_list","add_reading_list_success",C),e.pubsub.fire("savedstories_modal_displayed"),!1},hide:function(t){var n=$(t.target).closest(l),r=$(t.target).hasClass("btn-modal-close");if(n.length===0||r)l.modal("hide"),b.html("").empty(),$(document).off("click touchend",k.hide),e.pubsub.off("savedstories_list","delete_reading_list_request",N),e.pubsub.off("savedstories_list","add_reading_list_success",C);return!1}};return k}),define("bs/util/interface",[],function(){function e(e){this.members=e}return{factory:function(t){return new e(t)},ensureImplements:function(e,t){var n,r,i;for(n=0,r=t.members.length;n<r;n++){i=t.members[n];if(typeof e[i]=="undefined")throw new Error("InterfaceError: missing member '"+i+"'")}return!0}}}),define("bs/util/touchit",["bs/util/interface"],function(e){function t(e,t,n,r){if(e.addEventListener)return e.addEventListener(t,n,r),{destroy:function(){e.removeEventListener(t,n,r)}};var i=function(e){n.handleEvent(window.event,n)};return e.attachEvent("on"+t,i),{destroy:function(){e.detachEvent("on"+t,i)}}}function i(e,n,i){this.events=[],this.touchEvents=[],this.element=e,this.handler=n,this.useCapture=i,this.addClassTimer=null,this.removeClassTimer=null,r?this.events.push(t(e,"touchstart",this,this.useCapture)):this.events.push(t(e,"click",this,this.useCapture)),document.addEventListener("click",this.clickbuster.onClick,!0),this.clickbuster.coordinates=[]}var n="touching",r="ontouchstart"in window;return i.prototype={destroy:function(){for(var e=this.events.length-1;e>=0;e-=1)this.events[e].destroy();this.events=this.touchEvents=this.element=this.handler=this.fastButton=null},handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onClick(e);break;case"click":this.onClick(e)}},onTouchStart:function(e){var r=this.element,i=n;this.touchEvents.push(t(this.element,"touchend",this,this.useCapture)),this.touchEvents.push(t(document.body,"touchmove",this,this.useCapture)),this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.addClassTimer!=null&&clearTimeout(this.addClassTimer),this.removeClassTimer!=null&&clearTimeout(this.removeClassTimer),this.hasClass(r,i)||(this.addClassTimer=setTimeout(function(){r.className=r.className+" "+i},10),this.removeClassTimer=setTimeout(function(){r.className=r.className.replace(new RegExp("\\b"+i+"\\b"),"")},310))},onTouchMove:function(e){var t=this.element;if(Math.abs(e.touches[0].clientX-this.startX)>10||Math.abs(e.touches[0].clientY-this.startY)>10)this.removeClass(this.element,n),this.reset()},onClick:function(e){e.stopPropagation();var t=this.element,n=this.handler.call(this.element,e);return e.type==="touchend"&&this.clickbuster.preventGhostClick(this.startX,this.startY),this.reset(),n},addClass:function(e,t){e.className=e.className+" "+t},removeClass:function(e,t){e.className=e.className.replace(new RegExp("\\b"+t+"\\b"),"")},hasClass:function(e,t){return e.className.indexOf(t)>-1?!0:!1},reset:function(){clearTimeout(this.addClassTimer),this.addClassTimer=null,clearTimeout(this.removeClassTimer),this.removeClassTimer=null,setTimeout(this.removeClass(this.element,n),200);for(var e=this.touchEvents.length-1;e>=0;e-=1)this.touchEvents[e].destroy();this.touchEvents=[]},clickbuster:{preventGhostClick:function(e,t){this.coordinates.push(e,t),setTimeout(this.pop,2500)},pop:function(){typeof this.coordinates!="undefined"&&this.coordinates.splice(0,2)},onClick:function(e){if(typeof this.coordinates!="undefined")for(var t=0;t<this.coordinates.length;t+=2){var n=this.coordinates[t],r=this.coordinates[t+1];Math.abs(e.clientX-n)<25&&Math.abs(e.clientY-r)<25&&(alert("ghost click"),e.stopPropagation(),e.preventDefault())}}}},{factory:function(e,t,n){return new i(e,t,n)}}}),define("bs/widgets/headersearch2",["bs/util/helpers","bs/util/touchit","jquery"],function(e,t,n){function p(e){return Modernizr.csstransitions?(o.on(h,d),r.addClass(a)):d(),u.focus(),!1}function d(e){n(document).on("click touchend",v),Modernizr.csstransitions?(o.off(h,d),r.removeClass(a).addClass(f)):r.addClass(f),c=!0}function v(e){Modernizr.csstransitions&&e.target.name!=="q"&&c?(n(document).off("click touchend",v),o.on(h,m),r.removeClass(f).addClass(l)):c&&e.target.name!=="q"&&m(e)}function m(e){Modernizr.csstransitions?(o.off(h,m),r.removeClass(l)):r.removeClass(f),c=!1,u.blur(),n(document).off("click touchend",v)}function g(e){Modernizr.csstransitions&&o.off(h,m),r.removeClass(l),r.removeClass(f),c=!1,u.blur(),n(document).off("click touchend",v)}var r=n("#digg-header"),i=document.getElementById("nav-search"),s=n(i),o=n("#form-digg-search"),u=n("#form-digg-search-input"),a="nav-search-expand",f="nav-search-active",l="nav-search-collapse",c=!1,h=e.transitionEndEventNames[Modernizr.prefixed("transition")];return{init:function(){document.addEventListener?t.factory(i,p):n(i).on("click",p),BS.pubsub.on("mobileheader","mobile_nav_collapse",g)}}}),define("bs/widgets/mobileheader",["jquery","bs/core","bs/util/touchit","lodash"],function(e,t,n,r){function a(n){var r="mobile-nav-active";u&&(f(),u=!1),s.hasClass(r)?(s.removeClass(r),e("body").removeClass("freeze-scroll"),t.pubsub.fire("mobile_nav_collapse")):(s.addClass(r),e("body").addClass("freeze-scroll"))}function f(){var e=l(),t=s.height(),n=e-t;window.matchMedia&&window.matchMedia("(max-width:879px)").matches?o.css("height",n):window.matchMedia&&window.matchMedia("(min-width:880px)").matches&&o.css("height",55)}function l(){return document.documentElement.clientHeight}function c(){f(),u=!1}function h(e){var t=document.getElementById("digg-header");if(e&&e.target===t)return e.stopPropagation(),e.preventDefault(),!1}var i=document.getElementById("digg-nav-toggle"),s=e("#digg-header"),o=s.find(".digg-nav-wrap"),u=!0;return{init:function(){e(window).on("resize orientationchange",r.throttle(c,100)),e(document).on("touchstart",h),document.addEventListener?n.factory(i,a):e(i).on("click",a)}}}),define("bs/widgets/promobanner",["require","bs/core","bs/util/cookies"],function(e,t,n){function s(){var e=$(this).parents(i).data("campaign");n.set({name:e,value:1,expires:new Date((new Date).valueOf()+31536e6),path:"/"}),$("body").addClass("promo-collapse"),i.off("click touchend",".promo-close-btn",s)}var r=!1,i=$("#site-promo-banner"),o={init:function(){i.length>0&&!r&&i.on("click touchend",".promo-close-btn",s)}};return o}),define("text!bs/templates/story.html",[],function(){return'<article class="story-container story-<%= content.content_id %> digg-story-el" data-content-id="<%= content.content_id %>" data-contenturl="<%=content.url%>" data-position="<%=position%>" data-diggs="<%= diggs.count %>" data-tweets="<%= tweets.count %>" data-fb-shares="<%= fb_shares.count %>" data-digg-score="<%= digg_score %>">\n    <% if (typeof image != \'undefined\') { %>\n    <div class="story-image">\n        <a data-position="<%=position%>" data-content-id="<%= content.content_id %>" class="story-link" href="<%= content.url %>" target="<%=content.link_target%>">\n            <img class="story-image-img" src="<%= image.url %>" width="<%= image.width %>" height="<%= image.height %>" alt="" />\n        </a>\n    </div>\n    <% } %>\n    <div class="story-content">\n        <header class="story-header">\n            <div class="story-kicker"><%= content.kicker %></div>\n            <h2 class="story-title entry-title">\n                <a class="story-title-link story-link" href="<%= content.url %>" target="<%=content.link_target%>"><%= content.title ? content.title.replace(/(\\S+) (\\S+)$/, "$1&nbsp;$2") : "" %></a>\n            </h2>\n            <div class="story-meta">\n            <% if (typeof showDiggsNotDiggScore !== \'undefined\' && showDiggsNotDiggScore) { %>\n                <div class="story-score<% if (diggs.count == 0) { %> story-score-zero<% } %>">\n                    <div class="story-score-diggs-not-diggscore"><span class="count diggs-<%= content.content_id %>"><%= diggs.count %></span>&nbsp;<span class="label diggs-label-<%= content.content_id %>"><% if (diggs.count == 1) { %>digg<% } else { %>diggs<% } %></span></div>\n                    <div class="story-score-diggscore hide-diggscore diggscore-<%= content.content_id %>"><%= digg_score %></div>\n            <% } else { %>\n                <div class="story-score<% if (digg_score == 0) { %> story-score-zero<% } %>">\n                    <div class="story-score-diggscore diggscore-<%= content.content_id %>"><%= digg_score %></div>\n            <% } %>\n                    <div class="story-score-details">\n                        <div class="arrow"></div>\n                        <ul class="story-score-details-list">\n                            <li class="story-score-detail story-score-diggs"><span class="label">Diggs:</span> <span class="count diggs-<%= content.content_id %>"><%= diggs.count %></span></li>\n                            <li class="story-score-detail story-score-twitter"><span class="label">Tweets:</span> <span class="count tweets-<%= content.content_id %>"><%= tweets.count %></span></li>\n                            <li class="story-score-detail story-score-facebook"><span class="label">Facebook Shares:</span> <span class="count fb_shares-<%= content.content_id %>"><%= fb_shares.count %></span></li>\n                        </ul>\n                    </div>\n                </div>\n            <% if (content.domain_name != \'YouTube\') { %>\n                <span class="story-meta-item story-source">\n                    <a itemprop="publisher copyrightHolder sourceOrganization provider" class="story-meta-item-link story-source-link" href="/source/<%= content.domain %>"><%= content.domain_name %></a>\n                </span>\n            <% } %>\n            <% if (content.tags && content.tags.length) { %>\n                <% for (var i = 0, j = content.tags.length; i < j; i++) { %>\n                    <span class="story-meta-item story-tag<% if (i === 0) { %> first-tag<% } %>">\n                        <a itemprop="keywords" class="story-meta-item-link story-tag-link" href="/tag/<%= content.tags[i].slug %>"><%= content.tags[i].display %></a>\n                    </span>\n                <% } %>\n            <% } %>\n            <% if (date !== null) { %><abbr class="published story-meta-item story-timestamp"><time><%= formattedDate %></time></abbr><% } %>\n            </div>\n        </header>\n    </div>\n    <ul class="story-actions">\n        <li class="story-action story-action-digg btn-story-action-container"><a class="target digg-<%= content.content_id %>" href="#">Digg</a></li>\n        <li class="story-action story-action-save btn-story-action-container"><a class="target save-<%= content.content_id %>" href="#">Save</a></li>\n        <li class="story-action story-action-share"><a class="target share-facebook" href="<%= fblink %>">Facebook</a></li>\n        <li class="story-action story-action-share"><a class="target share-twitter" href="<%= tweetlink %>">Twitter</a></li>\n    </ul>\n</article>\n'}),define("bs/widgets/popularvideos",["bs/core","bs/util/xhr","bs/util/format","bs/util/storyscores","text!bs/templates/story.html","lodash"],function(e,t,n,r,i,s){function v(){o.addClass("loaded"),u.html("<div class='stories-error'>There was problem loading the Most Dugg Videos. Wait a moment and try again.</div>")}function m(t){var r=t.data.feed,i=[],f="";s.each(r,function(t,r){t.position=r,t.content.link_target=t.content.link_to_publisher?"_blank":"_self",t.content.title=t.content.title_alt?t.content.title_alt:t.content.title,t.image=s.findWhere(t.content.media.images,{blurred:!1,type:"large_thumb"}),r===0&&(f=s.findWhere(t.content.media.images,{blurred:!0,type:"marquee_standard"})),t.formattedDate=n.secondsToFuzzyTime(t.date),t.diggs.count=n.intWithCommas(t.diggs.count),t.tweets.count=n.intWithCommas(t.tweets.count),t.fb_shares.count=n.intWithCommas(t.fb_shares.count),t.digg_score=n.intWithCommas(t.digg_score),t.showDiggsNotDiggScore=!0,t.tweetlink="https://twitter.com/intent/tweet?url=http://on.digg.com/"+t.content.content_id+"&via=Digg&text="+encodeURIComponent(t.content.title),t.fblink="https://www.facebook.com/dialog/feed?display=popup&app_id="+e.config.FB_APP_ID+"&link=http://on.digg.com/"+t.content.content_id+"&redirect_uri=http://digg.com/fbshare",i.push(a(t))}),o.addClass("loaded").css("background-image","url("+f.url+")"),u.empty().append(i.join(""))}var o=$("#popular-videos"),u=o.find(".content"),a=s.template(i),f='<header class="header"><h2 class="hed">Most Dugg Videos</h2><a class="view-all" href="/video/">View All</a></header>',l=r.factory("popular_videos"),c=[],h=!1,p={count:5,exclude_sponsored:!0},d=new t.dataProvider({url:"/api/video/popular.json",data:p,success:function(e){m(e),c=s.map(e.data.feed,function(e){return e.content.content_id}),c.length?l.register(c):v()},error:function(e){v()}});return{init:function(){if(h)return;h=!0,d.request()}}}),define("bs/widgets/popularstories",["bs/core","bs/util/xhr","bs/util/format","bs/util/storyscores","text!bs/templates/story.html","lodash"],function(e,t,n,r,i,s){function d(){o.addClass("loaded"),u.html("<div class='stories-error'>There was problem loading the Most Dugg Stories. Wait a moment and try again.</div>")}function v(t){var r=t.data.feed,i=[],f="";s.each(r,function(t,r){t.position=r,t.content.link_target=t.content.link_to_publisher?"_blank":"_self",t.content.title=t.content.title_alt?t.content.title_alt:t.content.title,t.image=s.findWhere(t.content.media.images,{blurred:!1,type:"large_thumb"}),t.formattedDate=n.secondsToFuzzyTime(t.date),t.diggs.count=n.intWithCommas(t.diggs.count),t.tweets.count=n.intWithCommas(t.tweets.count),t.fb_shares.count=n.intWithCommas(t.fb_shares.count),t.digg_score=n.intWithCommas(t.digg_score),t.showDiggsNotDiggScore=!0,t.tweetlink="https://twitter.com/intent/tweet?url=http://on.digg.com/"+t.content.content_id+"&via=Digg&text="+encodeURIComponent(t.content.title),t.fblink="https://www.facebook.com/dialog/feed?display=popup&app_id="+e.config.FB_APP_ID+"&link=http://on.digg.com/"+t.content.content_id+"&redirect_uri=http://digg.com/fbshare",i.push(a(t))}),o.addClass("loaded"),u.empty().append(i.join(""))}var o=$("#popular-stories"),u=o.find(".content"),a=s.template(i),f={count:10,exclude_sponsored:!0,exclude_videos:!0},l=new t.dataProvider({url:"/api/news/popular.json",data:f,success:function(e){h=s.map(e.data.feed,function(e){return e.content.content_id}),h.length?(c.register(h),v(e)):d()},error:function(e,t,n){d()}}),c=r.factory("popular_stories"),h=[],p=!1;return{init:function(){if(p)return;p=!0,l.request()}}}),define("bs/widgets/upcomingstories",["bs/core","bs/util/xhr","bs/util/format","bs/util/storyscores","text!bs/templates/story.html","lodash"],function(e,t,n,r,i,s){function d(){o.addClass("loaded"),u.html("<div class='stories-error'>There was problem loading the Upcoming Stories. Wait a moment and try again.</div>")}function v(t){var r=t.data.feed,i=[],f="";s.each(r,function(t,r){t.position=r,t.content.link_target=t.content.link_to_publisher?"_blank":"_self",t.content.title=t.content.title_alt?t.content.title_alt:t.content.title,t.formattedDate=n.secondsToFuzzyTime(t.date),t.diggs.count=n.intWithCommas(t.diggs.count),t.tweets.count=n.intWithCommas(t.tweets.count),t.fb_shares.count=n.intWithCommas(t.fb_shares.count),t.digg_score=n.intWithCommas(t.digg_score),t.showDiggsNotDiggScore=!0,t.tweetlink="https://twitter.com/intent/tweet?url=http://on.digg.com/"+t.content.content_id+"&via=Digg&text="+encodeURIComponent(t.content.title),t.fblink="https://www.facebook.com/dialog/feed?display=popup&app_id="+e.config.FB_APP_ID+"&link=http://on.digg.com/"+t.content.content_id+"&redirect_uri=http://digg.com/fbshare",i.push(a(t))}),o.addClass("loaded"),u.empty().append(i.join(""))}var o=$("#upcoming-stories"),u=o.find(".content"),a=s.template(i),f=r.factory("upcoming_stories"),l=[],c=!1,h={count:15},p=new t.dataProvider({url:"/api/news/upcoming.json",data:h,success:function(e){l=s.map(e.data.feed,function(e){return e.content.content_id}),l.length?(f.register(l),v(e)):d()},error:function(e){d()}});return{init:function(){if(c)return;c=!0,p.request()}}}),define("bs/widgets/footer",["bs/core","bs/util/xhr","jquery"],function(e,t,n){function r(){var r=n.trim(n("#digg-reader-email-form-input").val()),i="/api/promo/signup.json",s=new t.dataProvider({url:i,type:"POST",data:{promo:"reader_android",email:r},success:function(t){n("#digg-reader-email-form").hide(),n("#digg-reader-email-error").hide(),n("#digg-reader-email-success").html("Thanks!").show(),e.pubsub.fire("save_digg_reader_submit_complete")},error:function(e){n("#digg-reader-email-error").html("There was a problem submitting your email.").show()}});return s.request(),!1}function i(){var r=n.trim(n("#daily-digg-email-input").val()),i="/api/dailydiggemail.json",s=new t.dataProvider({url:i,type:"POST",data:{email:r},success:function(t){n("#daily-digg-email-form").hide(),n("#daily-digg-email-error").hide(),n("#daily-digg-email-success").html("Thanks for subscribing!").show(),e.pubsub.fire("save_daily_digg_submit_complete")},error:function(e){n("#daily-digg-email-error").html("There was a problem submitting your email. Please try again.").show()}});return s.request(),!1}n(function(){Modernizr.inputtypes.email&&n("#daily-digg-email-input").clone().attr("type","email").insertAfter("#daily-digg-email-input").prev().remove(),n("#footer-copyright-year").html((new Date).getFullYear()),n("#daily-digg-email-input").on("keyup",function(e){e.keyCode==13?i():n("#daily-digg-email-error").html("&nbsp;")}),n("#daily-digg-email-submit-btn").on("click",function(e){i()}),n("#digg-reader-email-form-input").on("keyup",function(e){return e.keyCode==13?r():n("#digg-reader-email-error").html("&nbsp;"),e.stopPropagation(),e.preventDefault(),!1}),n("#reader-promo-submit-btn").on("click",function(e){r()}),n("#daily-digg-email-form").addClass("ready"),n("#digg-reader-email-form").addClass("ready")})}),require(["bs/core","bs/util/storyactions2","bs/util/storyscores","bs/util/pagesectionmonitor","bs/util/tracking","bs/util/cookies","bs/widgets/lazyimages","bs/widgets/usernav","bs/widgets/savedstories2","bs/widgets/headersearch2","bs/widgets/mobileheader","bs/widgets/promobanner","bs/widgets/popularvideos","bs/widgets/popularstories","bs/widgets/upcomingstories","bs/widgets/footer","bs/widgets/onboarding","lodash"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function y(t,n){var r=document.getElementById("top-stories").getBoundingClientRect(),i=100;if(n||t>=r.bottom-i)h.init(),p.init(),d.init(),$(".ftr-ios-hero-img").addClass("lazy-loaded"),e.pubsub.off("scroll",e.pubsub.channels.scrolltop,y)}function b(){var e=document.getElementById("popular-videos").getBoundingClientRect(),t=$(document).scrollTop();y(t,!0),t<e.top&&$("html,body").animate({scrollTop:e.bottom-25},1e3)}function E(){function o(){var e=[{src:"/static/audio/rickLoop.mp3",type:"audio/mp3"},{src:"/static/audio/rickLoop.ogg",type:"audio/ogg"}];i=document.createElement("audio");if(!i.canPlayType)return;g.each(e,function(e,t){var n=document.createElement("source");n.setAttribute("src",e.src),n.setAttribute("type",e.type),i.appendChild(n)}),$("body").append(i),i.volume=0,i.addEventListener("ended",function(){a()},!1),i.play(),u()}function u(){if(s>=1)return;i.volume=s,s+=.1,setTimeout(u,500)}function a(){var e;for(var t=0;t<7;t++)e=$(n[t]),e.attr("src",e.attr("data-src"))}function f(){var e,r;if(!t.length)return;r=t.pop(),e=$(n[r-1]),e.addClass("img-rr"),e.css({opacity:0}),e.attr("data-src",e.attr("src")),e.attr("src","/static/images/rr/"+r+"-png.jpg"),e.fadeTo(1e3,1),r===3?(setTimeout(f,5e3),o()):f()}function l(){var e=[],n;g.each(t,function(t,n){e[n]={img:new Image,done:new $.Deferred},e[n].img.onload=function(){e[n].done.resolve()},e[n].src="/static/images/rr/"+n+"-png.jpg"}),n=g.map(t,function(e,t){return e.done}),$.when.apply(this,n).then(f)}var t=[2,3,1,4,5,6,7].reverse(),n=$(".story-image-img"),r=0,i,s=0;l(),e.pubsub.fire("spreadgun","http://digg.com/")}var w={init:function(){window.location.hash==="#upcoming"&&b(),o.init(),u.init(),f.init(),c.init(),l.init(),e.features.edit_mode&&$("#edit-mode-label-container").insertBefore(".site-header-container"),e.features.saved_stories&&a.initialize({elID:"#modal-savedstories"});var r=$(".story-container"),i=g.map(r,function(e){return $(e).data("contentId")}),s=n.factory("top_stories");i.length&&s.register(i),e.pubsub.on("score_updates",e.pubsub.channels.scores_update,function(e){$(function(){t.renderStoryScores(e)})}),$(document).on("click",".launch-dailydigg-modal",m.dailyDiggModal).on("click",".story-action-digg > .target",e.user.authorized(t.submitDigg,"Digg")).on("click",".story-action-save > .target",e.user.authorized(t.addReadingList,"Save")).on("click",".story-action-share > .target",t.shareStory).on("click",".story-link",t.redirectStoryLink),m.dailyDiggModalHash(),$(function(){e.pubsub.on("scroll",e.pubsub.channels.scrolltop,y),y($(document).scrollTop())})}};$.fn.k=function(e,t){return t===undefined&&(t="38,38,40,40,37,39,37,39,66,65"),this.each(function(){var n=[];$(this).keydown(function(r){n.push(r.keyCode),n.toString().indexOf(t)>=0&&($(this).unbind("keydown",arguments.callee),e(r))})})},$(window).k(E),w.init()}),define("bs/frontpage",function(){})})();